# 4、计算机网络

### 4.1 开放互联参考模型

1. 七层机构由低到高
2. 物理层：二进制传输
3. 数据链路层：传输帧为单位的信息，头尾由mac地址
4. 网络层：数据分组。p地址、端口等信息
5. 传输层：端到端的链接
6. 会话层：建立、管理、终止会话
7. 表示层：主要负责格式表达压缩、加密等数据格式相关操作
8. 应用层：具体的应用功能比如播放视频



各层对应的东西

物：中继器、集线器（多口中继器）。在同一冲突与域，集线器一个端口为一个冲突域

数：网桥、交换机、网卡。同一网络内、局域网，一个广播域

网络层：三层交换机、路由器。一个端口一个广播域，也可以对应一个冲突域

传输层：tcp、udp

会、表、应：ftp、http、dns等



防火墙有网络层的也有应用层的



### 4.2 TCP/IP基础

四层模型（由低到高）：

1. 网络接口层（物理层+数据链路层）
2. 网际层（网络层）：IP协议
3. 传输层（传输层）
4. 应用层（会表应）

网络层协议：

1. IP是TCP的基础
2. ARP/RARP：ip转mac和mac转ip
3. ICMP：对组播传输管理协议。对ping进行打包执行

传输层协议：

1. TCP可靠，三次握手确保传输正常
2. UDP随便传不管传输正常不正常

应用层协议：

1. 基于TCP：
2. HTTP（80端口）、
3. TEINET（23、远程协议，明文所以可靠但不安全）、
4. FTP（20上传文件端口/21控制端口）、
5. SMTP（25、邮件相关）、
6. POP3（110、邮件相关）
7. 基于UDP：
8. SNMP（161，简单网络管理协议）、
9. DNS（53、域名解析协议）、
10. TFTP（69，简单文件传输协议）、
11. DHCP（67，自动获取ip）



TCP与UDP对比

共同点：都是基于ip，进行端口寻址

不同点：

1. TCP面向链接，UDP无连接
2. TCP三次握手、流量控制、差错校验、重传、顺序接收，不丢失不重复、可靠性强、牺牲通信量、效率低；UDP无链接、无流量控制、无阻塞控制、有助于提高传输速率、不对无序数据重新排序，不重传、不消除重复、不校验、不终止建立链接，这些由应用程序进行处理



TCP的限流逻辑：在建立连接时根据接收端接收能力双方商定缓冲区大小，发送合适大小的数据，接收端接收后发回确认信息，发送端根据确认信息调整下次发送的窗口大小，所以是 可变大小的滑动窗口



协议应用提升

DHCP：基于C/S类型，

动态分配：客户向服务器申请ip，租约默认8天，租约过半时客户机会重新申请续租，租约超过87.5%如果没有联系上原来的服务器，则寻找新的服务器申请

自动分配：分配一次永久使用

固定分配：每台机器获取的ip固定

设定有两个无效ip:169.254.x.x和0.0.0.0  dns没有理客户端时会返回



DNS协议：输入域名，查hosts（记录域名-ip对应关系）文件,如果找不到则找dns缓存-本地dns服务器-根域名服务器-顶级域名服务器-权限域名服务器

域名服务器接收到域名请求：查本地DNS缓存-根域名服务器。这个不差hosts，注意



### 4.3 网络诊断命令

ipconfig：查看tcpip网络配置

ping：检查网络是否通畅，点与点之间的检查，ping只针对一个地址

tracert：确定ip访问目标过程去经过的路径，若网络不通能定位到哪个节点不通

nslookup：查询dns记录

netstat：显示网络连接、路由表、端口信息



路由状态

listen：有无连接

包含syn：等待连接

established：打开连接

包含fin：等待中断

close：中断



### 5.4 ip地址与子网划分

ip地址分类，主要了解结构和范围

1. A：0+7位网络号+24位主机号      0+网络号范围 0（8个0）-127（一个0 7个1）
2. b:  10+14位网络号+16位主机号  10+网络号范围为 128-191
3. c：110+21位网络号+8位主机号   100+网络号范围为 192-223
4. d：未用
5. e：未用

全0不能作为主机号，作为网络本身地址，全1在ipv4作为广播地址，不能作为主机号，计算主机个数时减去2



特殊ip地址

127网段：回播地址，本地回环地址

主机号全0

主机号全1

169.254.0.0/0.0.0.0：保留地址用于dhcp失效时





子网划分与路由汇聚

ip地址/n：表示n位为网络号，剩余为主机号

子网掩码：配合ip计算网络号。ip为 192.168.0.1 子网掩码为255.255.255.0，二者进行与操作得出192.168.0.0，网络号为192.168.0为24位c类ip地址。子网掩码网络号为1，主机号为0



子网划分：将一个网络划分为多个子网。网络号+子网号+主机号，将主机号拆分为子网号+主机号，子网号属于网络号的一部分，在子网掩码中为1

例：b类网络 168.195.0.0划分27个子网，求子网掩码

1. 29个子网需要5位表示，2^5=32
2. b类原来的子网掩码为255.255.0.0
3. 在原有的主机位上取出5位当做子网位，此时网络为16位+子网位5位，则子网掩码： 255.255.248（11111000）.0

求每个子网有多少主机

网络位为16+5=21，所以主机位有32-21=11位，所以主机个数为2^11-2（全0全1）



例2：b类网络 168.195.0.0，每个子网700个主机，求可划分多少个子网，求子网掩码

1. 2^10=1024-2>700,所以至少要10才能每个子网有700主机
2. b类原来有网络号16位，现有主机号10位，所以子网号为32-16-10=6，所以可划分2^6个子网
3. 子网掩码为16+6=22位网络号  255.255.252（11111100）.0



路由汇聚：将多个网络合并成一个大网络

比如 202.118.133.0/24和202.118.130.0/24  网络位（前24位）公共部分合并成一个网络  133（10000101）和130（10000010）前五位一致   所以前8+8+5=21位作为一个网络号，剩余的为主机号。汇聚后为202.118.128.0/21，先找汇聚后的地址，再分开查找133和130网络。类似于先找山东省再找淄博市、济南市



例题

与地址220.112.179.92匹配的路由表表项（即可能在该地址的出现的地址）

220.112.145.32/22

220.112..145.64/22

220.112.147.64/22

220.112.177.64/22

可能在路由表中出现则两个地址位于同一网络 220.112部分都一致，所以看第三部分

179   1011 0011

145   1001 0001

147   1001 0011

177   1011 0001

都是22位网络号，22-16=6，所以第三部分前6位一样则处于同一网络内，所以为220.112.177.64/22



IPV6为了解决ip不够用的情况

特点：

1. ipv6长128位，16进制
2. 灵活的报文头部格式，加快了处理速度
3. 简化了头部格式，提高了传输速度和吞吐量
4. 提高安全性
5. 支持更多服务类型
6. 允许继续演变，留有发展空间



地址分类

1. 单播地址：点对点通信。全网络可聚合单播地址 001开头，本地链路站点 fe80开头，本地站点 1111111011开头
2. 组播地址：多播地址，一点对多点
3. 任播地址：ipv6新增方式，目标时一组计算机，但只交付给最近的一个。类似于老师通知课代表，课代表再通知全班



地址格式：冒分16进制 8个16进制表示  2001:0db8:0000:1319:0000:0000:0000:0000

某段0000 可用0表示，连续的0000:0000 可直接用：：表示但只能用一次否则无法计算省略了几个段



v4-v6过度技术

双协议栈技术：同时支持4和6

隧道技术：将6的包，打包成4的包通过4之后在转换为6

nat-pt技术：加中间站点负责翻译



4有2^32个地址，6有2^128个地址，所以6的个数是4的2^96倍















