# 2、操作系统

### 2.1 操作系统的作用

自下往上：硬件 - 操作系统（bios也算）- 语言处理程序 （系统软件，比如数据库、开发软件等）- 应用程序（程序开发）

操作系统的作用

1. 管理系统软硬件、数据资源
2. 控制程序运行
3. 人机之间的借口
4. 应用软件与硬件之间的借口



操作系统的任务：

1. 进程管理
2. 存储管理
3. 文件管理
4. 作业管理
5. 设备管理



特殊的操作系统

批处理操作系统：分为单道批和多道批，区别在于一次将一个还是多个作业入内存

分时操作系统：通过轮训形式实现，各个用户感觉独占系统。多路性、独立性、交互性、及时性

实时操作系统：实时控制系统，交互能力不高，可靠性高，要求规定时间内响应并处理

网络操作系统：用于服务器

分布式操作系统：多台计算机可通讯交换信息，是网络操作系统的高级形式

微机操作系统：win10

嵌入式操作系统：运行在智能芯片中。微型化，可定制（根据硬件配置）、实时性、可靠性、易移植性（HAB和BSP支持）





### 2.2 进程与线程

进程：程序在一个数据集合上运行的过程，是系统进行资源分配、调度的基本单位，由程序块、进程控制块（PCB）、数据块三部分组成。

PCB：进程存在的唯一标志，内容包括标识符、状态、控制指针、队列信息（链接同一状态的进程）、优先级、现场保护区等

进程是程序的一次执行过程，程序是静态对的，进程是静态程序运行后的动态的概念

线程（重点）：一个进程中有多个线程，且各个线程共享进程中的资源。其中线程的程序计数器、寄存器、栈独立记录，不会在线程之间共享。



### 2.2.3 进程的状态

三态模型：运行（单处理机处于运行态的进程只有一个）、就绪（除了cpu资源之外的其他资源全部满足。默认资源不可以被剥夺）、等待/阻塞/睡眠（非CPU资源不足时，满足后转换为就绪，不可直接转换为运行）



五态模型：运行、活跃就绪、静止就绪、活跃阻塞、静止阻塞

活跃与静止之间通过挂起操作进行转换；运行、活跃就绪、活跃阻塞与三态一致。静止阻塞满足条件后不激活可直接转换为静止就绪。

挂起的原因：内存不足、系统过程、程序开发断点



### 2.3 进程调度

临近资源：进程间需要互斥方式对其进行共享的资源（进程中访问临近资源的代码成为临界区）

互斥：如千军万马过独木桥。间接制约关系（通过需要共享的资源进行制约）

同步：速度有差异，在一定情况下等待。直接制约关系（快的一定要等待慢的）



pv必考

PV操作针对非CPU资源

PV操作：P加锁，V解锁。S代表信号量，组成PS（信号量+1）、VS（信号量-1）

PS ： s=s-1;(申请资源)   s<0;（检查是否足够）。s=0时表示刚申请到一个资源满足执行条件 。s<0时进入阻塞队列（阻塞态）



信号量与PV操作

针对临界资源，p与v成对操作



同步模型：设定市场容量为1，且生产一个产品必须消费后才可继续生产

生产-市场-消费者

生产：生产产品（p（s1））   （p（s3））送至市场  （v(s3)）（v(s2)）。

市场（缓冲区）：负责存放产品

消费者：从（p（s3））市场取出（v(s3)）产品 (p(s2))消费(v(s1))

s1与s2组成同步信号量且 s1初始值为1表示可生产一个； s2初始值为0表示市场中当前数量为0。

s3为互斥信号量，同一时间不论取还是存只能有一个操作，s3初始值为1，表示可有一个操作。



注：如果市场中无产品，消费者只能等待，所以是同步模型；如果市场产品爆仓，生产者只能等待消费者消费，所以是同步模型。

同步：速度快的等待速度慢的

互斥：一个人用其他人无法用



pv操作与前趋图（考的频繁）

a(vsa)->

b(vsb)-> (psa psb psc)d( vsd) -> (psd)e

c(vsc) ->

前趋图中箭头尾部对应v操作，箭头头部对应p操作

以上四个信号量初始化为0

v操作代表当前节点完成，p操作检查前驱是否完成，是否可以开始当前节点



### 2.4 死锁资源数计算

中等频率 1分左右 计算为主

死锁：两个以上的进程都要求对方已经占有的资源导致无法继续进行

形成死锁条件

1. 互斥。不互斥可打破死锁
2. 保持和等待。保持：一但获得不会放弃。等待：对于缺少的资源进行等待，配合保持导致死锁。A进程有a资源缺少b资源；B有b资源缺少a资源，AB都保持并等待导致死锁。不保持或不等待可打破死锁
3. 不剥夺。无法抢其他进程的资源。剥夺其他进程资源可打破死锁
4. 环路等待。例如2中的AB。破坏环路可打破死锁



死锁资源数的计算

假设有abcde5个进程各自需要4个资源。

1. 当资源数小于4时则时必定死锁，因为无法满足任意一个进程
2. 当资源数大于等于4并且小于等于15时则可能死锁，因为悲观情况下15个资源平均分无法满足任意一个程序
3. 当资源数大于等于16时则必定不会死锁，因为资源数至少满足一个进程

公式： （w-1）*m+1>=n

w每个进程需要的资源数；m个进程；n不发生死锁对的最小资源数。用悲观算法逻辑计算即可

解释：当有m个进程，且每个进程需要w个资源，有n个资源时不会发生死锁



### 2.5 进程资源图

圆形为资源，圆形中间写进程名称

长方形为资源，长方形内有几个圆代表有几个资源，圆形外写资源名称

箭头由进程指向资源表示申请资源

箭头由资源指向进程表示分配资源

进程资源图表示某一静态时刻资源与进程的分配关系，根据图判断是否产生死锁。

图中进程可满足需求的节点为非阻塞节点。

图中进程不满足需求的节点为阻塞节点。

判断是否为阻塞节点时不用考略释放资源

非阻塞资源=可化简。简化：将非阻塞节点算作执行完成，并释放资源。

是否死锁：所有简化完成后，假如还有阻塞节点则死锁



### 2.6 段页式存储

页式存储：将程序与内存划分为大小相同的页，以页为单位调入内存。由操作系统完成

程序中为逻辑地址，硬盘中为物理地址；逻辑地址=页号+页内地址，物理地址：页帧号+页内地址

根据逻辑地址求物理地址

假设页式存储中，页面大小为4kb，逻辑地址 10  1100 1101 1110

1. 页面总容量为4kb，默认存储单元为1b，所以有4k个存储单元=4096=2^12
2. 2^12所以需要12位二进制表示4k个存储单元的地址，所以1100 1101 1110为页内地址，10为页号
3. 10转换为十进制为2，查页表可得 页号2对应的页帧号为6，所以页帧号为110
4. 通过页帧号与页内地址求得逻辑地址为 110  1100 1101 1110

优点：利用率高，碎片小，分配、管理简单

却底单：增加了系统开销（频繁进出内存）；可能产生抖动现象（即使给程序增加了资源，也没有提高效率）





缺页中断：当内存中可存储的页式已满但又需要加载新的页，此时需要淘汰内存中的一页后将新的页加载到内存。

淘汰原则

1. 访问位为0
2. 多个访问位为0,情况下，淘汰修改位为0

注 访问位0修改为1 表示短期内无访但长期内有修改。有修改的页比无修改的页淘汰开销大一点因为要保存修改



页面置换算法

1. 最优算法，理想型
2. 随机算法，稳定性极差
3. 先进先出算法，可能抖动
4. 最近最少使用（LRU），该理论依据为局部性原理



段式存储

页式页面大小一致为避免逻辑上连续，调用上分散的情况（比如if在1页，循环体在2页），所以根据每个自然段的逻辑大小划分空间为段式存储



段表中记录 段号、段长、基地址

逻辑地址为 段号+偏移量（偏移量不可大于段长）  

0 30k 40k

逻辑地址：（0,25k）为0页中40k（基地址）+25k（偏移量且小于30k）=45k为物理地址

（0,50k） 非法逻辑地址因为0页的段长只有30k



优点：多程序共享内存，各段程序修改互不映像

缺点：内存利用率低，碎片浪费大



段页式存储

现将程序根据自然段分解成段，在将每个段分页。一个程序有n个段，一个段有m个页，结合了段式存储和页式存储

地址格式：段号+页号+页内地址

因为分段时，段的大小不一致，所以每段对应的页数不一定一样

段号（31-24）页号（23-13）页内地址（第12位-第0位）

所以存放 2^13个页内地址即2^13个存储单元，如果默认存储单元为1b则该页面大小为2^13b。页的最大个数为2^11个。段的最大个数为2^8



优点：解决空间浪费，存储共享容易 保护容易，能动态链接

却底单：效率低下，多次链接开销大





### 2.7 磁盘管理

考的较为频繁

磁道编号从外向内逐渐增大

垂直寻道：先找到对应的磁道，在找对应的扇区

存取时间（重点）=寻道时间+旋转延迟时间（从当前扇区旋转到目标扇区的时间）+传输时间

磁头都是统一移动，所以同一时刻所有磁头都在一个柱面上



移臂调度算法

先来先服务

最短寻道时间有限

扫描算法（电梯算法）：从最外层磁道（0磁道）向内扫描道最大磁道，处理移动过程中路过的需要；再从内向外进行扫描处理移动过程中路过的需要

循环扫描算法：单向，只能由内向外或者由外向内



缓冲区时间计算

数据读取到缓冲区需要15s，缓冲区将数据放入用户区需要5s，用户区处理需要1s

执行10次操作，缓冲区属于临界资源不可同时读写。可将单双缓冲区看做不同的流水线操作，使用流水线操作计算即可

单缓冲区情况下：

(（15+5）+1)+（10-1）*（15+5）=201

双缓冲区下，先给a缓冲区读数，a读完后给b读，b读完后a已将数据取出缓冲区（15>5,在b中读入数据使用15s，a区读出只需要5s）

（15+5+1）+（10-1）*15=156





### 2.8 IO管理软件

一般一分

分层：

1. 用户进程 发出IO调用
2. 设备无关程序 设备名解析、阻塞进程，分配缓冲区
3. 设备驱动 设置寄存器、检查设备状态
4. 中断处理程序 IO完成后唤醒设备驱动程序
5. 硬件 完成具体的IO操作



### 2.9 文件管理

考的频繁

基本概念

文件：具有符号名，在逻辑上有完整意义的一组相关信息的集合

逻辑结构：有结构的记录文件，无结构对的记录文件

物理结构：连续结构、链接结构、索引结构、多个物理块的索引表



目录结构

一级目录：线性结构，查找速度慢，不允许重名

二级目录：主文件目录（MFD）+用户目录（UFD）

三级目录：树形目录结构（多级目录结构）时



树形目录结构

绝对路径：从盘符开始，部分题盘符是 / 要记得写上。 /A/B/C.doc 假如访问文件夹 /A/B/ 不要掉了/

相对路径：当前文件夹下文件开始。比如当前文件夹为A，则B/C.doc 假如访问文件夹 B/ 不要掉了/

全文件名=绝对路径+文件名    /A/B/C.doc  文件名为 C.doc

不同文件夹下面可存在同名文件



位示图

字长32的计算机采用位示图，磁盘容量为300G，物理块大小为1mb，那么位示图大小为：

300*1024=307200个物理块。字长32所以一个字长能表示32个物理块，所以307200/32=9600个字

2054号物理块（从0开始），应该放在第几个字、地点几个位中呢

2054/32=64...7，所以是65个字的第6（编号从0开始）位，如果编号从0开始则编号64的字



索引文件

1-2分

一个索引结构默认13个节点

直接索引 10个节点 0-9号逻辑节点 访问一次磁盘找数据

1级索引1个 10号节点 访问两次磁盘找数据  能存储（页面大小/地址位数）个地址

二级索引1个 11号节点  能存储  （页面大小/地址位数）（页面大小/地址位数）个地址

二级索引1个 12号节点  能存储  （页面大小/地址位数）（页面大小/地址位数）（页面大小/地址位数）个地址



存放索引的叫索引盘，存放数据的叫数据盘

最大文件长度





作业管理

调度算法

先来先服务

时间片轮转

短作业优先

最高优先权优先

高响应比优先法： 响应比：（等待时间+执行时间）/执行时间







