# 2、操作系统

### 2.1 操作系统的作用

自下往上：硬件 - 操作系统（bios也算）- 语言处理程序 （系统软件，比如数据库、开发软件等）- 应用程序（程序开发）

操作系统的作用

1. 管理系统软硬件、数据资源
2. 控制程序运行
3. 人机之间的借口
4. 应用软件与硬件之间的借口



操作系统的任务：

1. 进程管理
2. 存储管理
3. 文件管理
4. 作业管理
5. 设备管理



特殊的操作系统

批处理操作系统：分为单道批和多道批，区别在于一次将一个还是多个作业入内存

分时操作系统：通过轮训形式实现，各个用户感觉独占系统。多路性、独立性、交互性、及时性

实时操作系统：实时控制系统，交互能力不高，可靠性高，要求规定时间内响应并处理

网络操作系统：用于服务器

分布式操作系统：多台计算机可通讯交换信息，是网络操作系统的高级形式

微机操作系统：win10

嵌入式操作系统：运行在智能芯片中。微型化，可定制（根据硬件配置）、实时性、可靠性、易移植性（HAB和BSP支持）





### 2.2 进程与线程

进程：程序在一个数据集合上运行的过程，是系统进行资源分配、调度的基本单位，由程序块、进程控制块（PCB）、数据块三部分组成。

PCB：进程存在的唯一标志，内容包括标识符、状态、控制指针、队列信息（链接同一状态的进程）、优先级、现场保护区等

进程是程序的一次执行过程，程序是静态对的，进程是静态程序运行后的动态的概念

线程（重点）：一个进程中有多个线程，且各个线程共享进程中的资源。其中线程的程序计数器、寄存器、栈独立记录，不会在线程之间共享。



### 2.2.3 进程的状态

三态模型：运行（单处理机处于运行态的进程只有一个）、就绪（除了cpu资源之外的其他资源全部满足。默认资源不可以被剥夺）、等待/阻塞/睡眠（非CPU资源不足时，满足后转换为就绪，不可直接转换为运行）



五态模型：运行、活跃就绪、静止就绪、活跃阻塞、静止阻塞

活跃与静止之间通过挂起操作进行转换；运行、活跃就绪、活跃阻塞与三态一致。静止阻塞满足条件后不激活可直接转换为静止就绪。

挂起的原因：内存不足、系统过程、程序开发断点



### 2.3 进程调度

临近资源：进程间需要互斥方式对其进行共享的资源（进程中访问临近资源的代码成为临界区）

互斥：如千军万马过独木桥。间接制约关系（通过需要共享的资源进行制约）

同步：速度有差异，在一定情况下等待。直接制约关系（快的一定要等待慢的）



pv必考

PV操作针对非CPU资源

PV操作：P加锁，V解锁。S代表信号量，组成PS（信号量+1）、VS（信号量-1）

PS ： s=s-1;(申请资源)   s<0;（检查是否足够）。s=0时表示刚申请到一个资源满足执行条件 。s<0时进入阻塞队列（阻塞态）



信号量与PV操作

针对临界资源，p与v成对操作



同步模型：设定市场容量为1，且生产一个产品必须消费后才可继续生产

生产-市场-消费者

生产：生产产品（p（s1））   （p（s3））送至市场  （v(s3)）（v(s2)）。

市场（缓冲区）：负责存放产品

消费者：从（p（s3））市场取出（v(s3)）产品 (p(s2))消费(v(s1))

s1与s2组成同步信号量且 s1初始值为1表示可生产一个； s2初始值为0表示市场中当前数量为0。

s3为互斥信号量，同一时间不论取还是存只能有一个操作，s3初始值为1，表示可有一个操作。



注：如果市场中无产品，消费者只能等待，所以是同步模型；如果市场产品爆仓，生产者只能等待消费者消费，所以是同步模型。

同步：速度快的等待速度慢的

互斥：一个人用其他人无法用



pv操作与前趋图（考的频繁）

a(vsa)->

b(vsb)-> (psa psb psc)d( vsd) -> (psd)e

c(vsc) ->

前趋图中箭头尾部对应v操作，箭头头部对应p操作

以上四个信号量初始化为0

v操作代表当前节点完成，p操作检查前驱是否完成，是否可以开始当前节点



### 2.4 死锁资源数计算

中等频率 1分左右 计算为主

死锁：两个以上的进程都要求对方已经占有的资源导致无法继续进行

形成死锁条件

1. 互斥。不互斥可打破死锁
2. 保持和等待。保持：一但获得不会放弃。等待：对于缺少的资源进行等待，配合保持导致死锁。A进程有a资源缺少b资源；B有b资源缺少a资源，AB都保持并等待导致死锁。不保持或不等待可打破死锁
3. 不剥夺。无法抢其他进程的资源。剥夺其他进程资源可打破死锁
4. 环路等待。例如2中的AB。破坏环路可打破死锁



死锁资源数的计算

假设有abcde5个进程各自需要4个资源。

1. 当资源数小于4时则时必定死锁，因为无法满足任意一个进程
2. 当资源数大于等于4并且小于等于15时则可能死锁，因为悲观情况下15个资源平均分无法满足任意一个程序
3. 当资源数大于等于16时则必定不会死锁，因为资源数至少满足一个进程

公式： （w-1）*m+1>=n

w每个进程需要的资源数；m个进程；n不发生死锁对的最小资源数。用悲观算法逻辑计算即可

解释：当有m个进程，且每个进程需要w个资源，有n个资源时不会发生死锁



### 2.5 进程资源图

圆形为资源，圆形中间写进程名称

长方形为资源，长方形内有几个圆代表有几个资源，圆形外写资源名称

箭头由进程指向资源表示申请资源

箭头由资源指向进程表示分配资源

进程资源图表示某一静态时刻资源与进程的分配关系，根据图判断是否产生死锁。

图中进程可满足需求的节点为非阻塞节点。

图中进程不满足需求的节点为阻塞节点。

判断是否为阻塞节点时不用考略释放资源

非阻塞资源=可化简。简化：将非阻塞节点算作执行完成，并释放资源。

是否死锁：所有简化完成后，假如还有阻塞节点则死锁













